<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Welcome to Firebase Hosting</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>
  <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
  <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>

</head>

<body>

  <label class="switch">
    <input type="checkbox" id="checkbox" checked>
    <div class="slider"></div>
  </label>


  <div class="card-body gauge-container" id="gauge2">
  </div>
  </div>
  <div class="card mb-4 box-shadow">
    <div class="card-header">
      <h4 class="my-0 font-weight-normal">G3</h4>
    </div>


    <input type="text" id="myInput">
    <button type="button" id="myButton">SET</button>
    <!-- <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.4/firebase-app.js";
    import { getDatabase, ref, get, set, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/9.6.4/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyApN_UInVP2mV0jKbsdAeRPUCXDYPZuCwU",
      authDomain: "iot-aeroponics.firebaseapp.com",
      databaseURL: "https://iot-aeroponics-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "iot-aeroponics",
      storageBucket: "iot-aeroponics.appspot.com",
      messagingSenderId: "685018331718",
      appId: "1:685018331718:web:cdb49e6a4d29a2f2372847",
      measurementId: "G-WCYJ0TPNEX"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();

    // btn.addEventListener("change", function () {
    //   this.checked ? label.innerHTML = "Button Turned On" :
    //     label.innerHTML = "Button Turned Off"
    // });

    //getdata from firebase db
    const dbRef = ref(getDatabase());
    // get(child(dbRef, `relays/relayPump`)).then((snapshot) => {
    //   var status = snapshot.val();
    //   if (Object.values(status).indexOf('ON') > -1) {
    //     var checkbox = document.querySelector('input[type="checkbox"]');
    //     checkbox.checked = true;
    //     console.log('RelayPUMP is ON');
    //   } else {
    //     var checkbox = document.querySelector('input[type="checkbox"]');
    //     checkbox.checked = false;
    //     console.log('RelayPUMP is OFF');
    //   }

    // });

    get(child(dbRef, `relays/relayPump`)).then((snapshot) => {
      
    }).catch((error) => {
      console.error(error);
    });




    // UPdate data to firebase db
    // set(ref(db, 'relays/relayPump'), {
    //   value: "ON"
    // })
    //   .then(() => {
    //     // Data saved successfully!
    //   })
    //   .catch((error) => {
    //     // The write failed...
    //   });



  </script> -->
</body>

</html>




<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.4/firebase-app.js";
  import { getDatabase, ref, get, set, child, update, remove, onValue } from "https://www.gstatic.com/firebasejs/9.6.4/firebase-database.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyApN_UInVP2mV0jKbsdAeRPUCXDYPZuCwU",
    authDomain: "iot-aeroponics.firebaseapp.com",
    databaseURL: "https://iot-aeroponics-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "iot-aeroponics",
    storageBucket: "iot-aeroponics.appspot.com",
    messagingSenderId: "685018331718",
    appId: "1:685018331718:web:cdb49e6a4d29a2f2372847",
    measurementId: "G-WCYJ0TPNEX"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getDatabase();

  //getdata from firebase db
  const dbRef = ref(getDatabase());

  get(child(dbRef, `relays/relayPump`)).then((snapshot) => {
    var status = snapshot.val().value;
    if (Object.values(status).indexOf('ON') > -1) {

      checkbox.checked = true;
      console.log('RelayPUMP is ON');
      console.log(status);
      $("#myInput").val(status);
    } else {
      checkbox.checked = false;
      console.log('RelayPUMP is OFF');
      console.log(status);
      $("#myInput").val(status);

    }
  })
    .then(() => {

    })
    .catch((error) => {
      // The write failed...
    });


  $("#myButton").click(function () {
    var relayPumpVal = $("#myInput").val();
    set(ref(db, 'relays/relayPump'), {
      value: relayPumpVal
    }).then(() => {
      console.log(relayPumpVal);
      alert('nice');
    }).catch((error) => {
      // The write failed...
    });
  });

    // set(ref(db, 'relays/relayPump'), {
    //   value: relayPumpVal
    // })
    //   .then(() => {
    //     console.log(relayPumpVal);
    //     // alert('nice');
    //   })
    //   .catch((error) => {
    //     // The write failed...
    //   });
</script>